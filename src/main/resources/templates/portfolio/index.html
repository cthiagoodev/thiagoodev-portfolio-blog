<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">

    <link rel="stylesheet" th:href="@{/css/main.css}">

    <title th:text="#{header.brand}">thiagoodev</title>
</head>
<body data-theme="dark">

<header th:replace="~{portfolio/fragments/header.html :: header}"></header>

<main>
    <section th:replace="~{portfolio/fragments/hero.html :: hero}"></section>
    <section th:replace="~{portfolio/fragments/about.html :: about}"></section>
    <section th:replace="~{portfolio/fragments/experiences.html :: experiences}"></section>
    <section th:replace="~{portfolio/fragments/projects.html :: projects}"></section>
</main>

<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const header = document.querySelector('header');
        const navLinks = Array.from(document.querySelectorAll('.nav__link[data-nav]'));

        const setActive = (key) => {
            navLinks.forEach(link => {
                const isActive = link.dataset.nav === key;
                link.classList.toggle('active', isActive);
                if (isActive) {
                    link.setAttribute('aria-current', 'page');
                } else {
                    link.removeAttribute('aria-current');
                }
            });
        };

        if (location && (location.pathname === '/' || location.pathname === '')) {
            setActive('inicio');
        }

        const sections = Array.from(document.querySelectorAll('[data-section]'));
        if (sections.length && 'IntersectionObserver' in window) {
            const intersectionObserver = new IntersectionObserver((entries) => {
                const visible = entries
                    .filter(entry => entry.isIntersecting)
                    .sort((a, b) => b.intersectionRatio - a.intersectionRatio)[0];
                if (visible?.target?.id) {
                    setActive(visible.target.id);
                }
            }, {
                rootMargin: '0px 0px -60% 0px',
                threshold: [0, 0.25, 0.5, 0.75, 1]
            });
            sections.forEach(section => intersectionObserver.observe(section));
        }

        const scrollElements = Array.from(document.querySelectorAll('.scroll-hidden'));
        if (scrollElements.length && 'IntersectionObserver' in window) {
            const scrollObserver = new IntersectionObserver((entries) => {
                entries.forEach((entry, index) => {
                    if (entry.isIntersecting) {
                        setTimeout(() => {
                            entry.target.classList.add('scroll-visible');
                        }, index * 100);
                        scrollObserver.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });
            scrollElements.forEach(element => scrollObserver.observe(element));
        }

        window.addEventListener('scroll', () => {
            if (window.scrollY > 50) {
                header.classList.add('header--scrolled');
            } else {
                header.classList.remove('header--scrolled');
            }
        });

        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const projectCards = document.querySelectorAll('.project-card');
        const projectsSection = document.getElementById('projetos');
        const INITIAL_VISIBLE_COUNT = 6;

        if (loadMoreBtn && projectCards.length > 0) {
            if (projectCards.length > INITIAL_VISIBLE_COUNT) {
                projectCards.forEach((card, index) => {
                    if (index >= INITIAL_VISIBLE_COUNT) {
                        card.classList.add('hidden-project');
                    }
                });
                loadMoreBtn.style.display = 'inline-flex';
            } else {
                loadMoreBtn.style.display = 'none';
            }

            loadMoreBtn.addEventListener('click', () => {
                const isExpanded = loadMoreBtn.textContent.trim() === 'Ver menos';

                if (isExpanded) {
                    projectCards.forEach((card, index) => {
                        if (index >= INITIAL_VISIBLE_COUNT) {
                            card.classList.add('hidden-project');
                        }
                    });
                    loadMoreBtn.textContent = 'Ver todos os projetos';

                    if (projectsSection) {
                        projectsSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                } else {
                    projectCards.forEach(card => {
                        card.classList.remove('hidden-project');
                    });
                    loadMoreBtn.textContent = 'Ver menos';
                }
            });
        }
    });
</script>
</body>
</html>