<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Basic Meta Tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="author" th:content="#{seo.author}">
    <meta name="description" th:content="#{seo.description}">
    <meta name="keywords" th:content="#{seo.keywords}">

    <!-- Theme and Branding -->
    <meta name="theme-color" content="#000000">
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Open Graph / Facebook / LinkedIn / WhatsApp -->
    <meta property="og:type" th:content="#{seo.og.type}">
    <meta property="og:title" th:content="#{seo.title}">
    <meta property="og:description" th:content="#{seo.description}">
    <meta property="og:url" th:content="#{seo.og.url}">
    <meta property="og:image" th:content="${profile != null ? profile.profileImage : '@{/images/profile.jpg}'}">
    <meta property="og:image:alt" th:content="#{seo.author}">
    <meta property="og:site_name" th:content="#{header.brand}">
    <meta property="og:locale" th:content="${#locale.toString()}">

    <!-- Twitter Card -->
    <meta name="twitter:card" th:content="#{seo.twitter.card}">
    <meta name="twitter:site" th:content="#{seo.twitter.site}">
    <meta name="twitter:creator" th:content="#{seo.twitter.site}">
    <meta name="twitter:title" th:content="#{seo.title}">
    <meta name="twitter:description" th:content="#{seo.description}">
    <meta name="twitter:image" th:content="${profile != null ? profile.profileImage : '@{/images/profile.jpg}'}">
    <meta name="twitter:image:alt" th:content="#{seo.author}">

    <!-- Canonical URL -->
    <link rel="canonical" th:href="#{seo.og.url}">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/images/favicon-32x32.png}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/images/favicon-16x16.png}">
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/images/apple-touch-icon.png}">
    <link rel="manifest" th:href="@{/site.webmanifest}">

    <!-- DNS Prefetch & Preconnect -->
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&display=swap"
          rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="stylesheet" th:href="@{/css/main.css}">

    <!-- Title -->
    <title th:text="#{seo.title}">Thiago Sousa | Engenheiro de Software</title>
</head>
<body data-theme="dark">

<aside class="social-sidebar">
    <a th:if="${profile != null and not #strings.isEmpty(profile.githubUrl)}"
       th:href="${profile.githubUrl}"
       class="social-sidebar__link"
       target="_blank"
       rel="noopener noreferrer"
       aria-label="GitHub">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg>
    </a>
    <a th:if="${profile != null and not #strings.isEmpty(profile.linkedinUrl)}"
       th:href="${profile.linkedinUrl}"
       class="social-sidebar__link"
       target="_blank"
       rel="noopener noreferrer"
       aria-label="LinkedIn">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg>
    </a>
    <a th:if="${profile != null and not #strings.isEmpty(profile.xUrl)}"
       th:href="${profile.xUrl}"
       class="social-sidebar__link"
       target="_blank"
       rel="noopener noreferrer"
       aria-label="X (Twitter)">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg>
    </a>
</aside>

<header th:replace="~{portfolio/fragments/header.html :: header}"></header>

<main>
    <section id="inicio" data-section th:replace="~{portfolio/fragments/hero.html :: hero}"></section>
    <section id="sobre" data-section th:replace="~{portfolio/fragments/about.html :: about}"></section>
    <section id="experiencias" data-section
             th:replace="~{portfolio/fragments/experiences.html :: experiences}"></section>
    <section id="projetos" data-section th:replace="~{portfolio/fragments/projects.html :: projects}"></section>
    <section id="comunidade" data-section th:replace="~{portfolio/fragments/community.html :: community}"></section>
</main>

<footer th:replace="~{portfolio/fragments/footer.html :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.8/dist/htmx.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const HEADER_HEIGHT = 60;
        const INITIAL_PROJECTS = 6;

        const header = document.querySelector('header');
        const navLinks = Array.from(document.querySelectorAll('.nav__link[data-nav]'));
        const sections = Array.from(document.querySelectorAll('[data-section]'));
        const heroSection = document.getElementById('inicio');
        const sidebar = document.querySelector('.social-sidebar');

        const setActiveNav = (key) => {
            navLinks.forEach(link => {
                const isActive = link.dataset.nav === key;
                link.classList.toggle('active', isActive);
                link[isActive ? 'setAttribute' : 'removeAttribute']('aria-current', 'page');
            });
        };

        const smoothScrollTo = (target) => {
            const offsetTop = target.offsetTop - HEADER_HEIGHT;
            window.scrollTo({top: offsetTop, behavior: 'smooth'});
        };

        const allInternalLinks = [
            ...navLinks,
            ...Array.from(document.querySelectorAll('.hero__actions a[href^="#"]'))
        ];

        allInternalLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetSection = document.getElementById(targetId);
                if (targetSection) {
                    smoothScrollTo(targetSection);
                    setActiveNav(targetId);
                }
            });
        });

        if (sections.length && 'IntersectionObserver' in window) {
            const navObserver = new IntersectionObserver((entries) => {
                const intersectingEntry = entries.find(entry => entry.isIntersecting);
                if (intersectingEntry) setActiveNav(intersectingEntry.target.id);
            }, {
                rootMargin: `-30% 0px -70% 0px`,
                threshold: 0
            });

            sections.forEach(section => navObserver.observe(section));
        }

        if (heroSection && sidebar && 'IntersectionObserver' in window) {
            const sidebarObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (!entry.isIntersecting) {
                        sidebar.classList.add('social-sidebar--visible');
                    } else {
                        sidebar.classList.remove('social-sidebar--visible');
                    }
                });
            }, {
                rootMargin: '-100px 0px 0px 0px',
                threshold: 0
            });

            sidebarObserver.observe(heroSection);
        }

        const scrollElements = Array.from(document.querySelectorAll('.scroll-hidden'));
        if (scrollElements.length && 'IntersectionObserver' in window) {
            const scrollObserver = new IntersectionObserver((entries) => {
                entries.forEach((entry, index) => {
                    if (entry.isIntersecting) {
                        setTimeout(() => {
                            entry.target.classList.add('scroll-visible');
                        }, index * 100);
                        scrollObserver.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            scrollElements.forEach(element => scrollObserver.observe(element));
        }

        window.addEventListener('scroll', () => {
            header.classList.toggle('header--scrolled', window.scrollY > 50);
        });

        const loadMoreBtn = document.getElementById('loadMoreBtn');
        const projectCards = Array.from(document.querySelectorAll('.card--project'));
        const projectsSection = document.getElementById('projetos');

        if (loadMoreBtn && projectCards.length > 0) {
            if (projectCards.length > INITIAL_PROJECTS) {
                projectCards.forEach((card, index) => {
                    if (index >= INITIAL_PROJECTS) card.classList.add('hidden-project');
                });
                loadMoreBtn.style.display = 'inline-flex';
            } else {
                loadMoreBtn.style.display = 'none';
            }

            loadMoreBtn.addEventListener('click', () => {
                const isExpanded = loadMoreBtn.classList.contains('is-expanded');

                if (isExpanded) {
                    projectCards.forEach((card, index) => {
                        if (index >= INITIAL_PROJECTS) card.classList.add('hidden-project');
                    });
                    loadMoreBtn.classList.remove('is-expanded');
                    loadMoreBtn.textContent = loadMoreBtn.dataset.textMore;
                    if (projectsSection) smoothScrollTo(projectsSection);
                } else {
                    projectCards.forEach(card => card.classList.remove('hidden-project'));
                    loadMoreBtn.classList.add('is-expanded');
                    loadMoreBtn.textContent = loadMoreBtn.dataset.textLess;
                }
            });
        }
    });
</script>
</body>
</html>